# Toy Logger Demo

Небольшое FastAPI‑приложение, показывающее централизованный сбор
структурированных логов в стек Fluent Bit → Loki → Grafana.

## Запуск

```bash
# собрать и запустить всё
docker compose up --build -d

# проверить API
curl http://localhost:8005/ping
curl http://localhost:8005/error
```

## Сервисы

- **toy-api** — небольшое FastAPI‑приложение. Логи пишет в stdout в формате JSON.
- **fluent-bit** — агент, считывающий docker‑логи из `/var/lib/docker/containers` и
  отправляющий их в Loki.
- **loki** — хранилище логов. Данные сохраняются в volume `loki_data` по пути
  `/loki`. Период хранения задан в конфигурации как 7 дней.
- **grafana** — веб‑интерфейс для просмотра логов и метрик.

## Как собираются логи

1. Приложение `toy-api` выводит структурированные сообщения в stdout.
2. Docker записывает эти сообщения в свои json‑логи контейнеров.
3. `fluent-bit` читает файлы логов и отправляет записи в Loki.
4. Loki сохраняет их на диск и индексирует для дальнейшего поиска.

## Где хранятся логи и сколько

Логи и индексы лежат в каталоге `/loki`, примонтированном как volume
`loki_data`. В `loki-config.yaml` указан `retention_period: 7d`, поэтому
записи старше семи дней автоматически удаляются.

## Просмотр логов в Grafana

Откройте [`http://localhost:3005`](http://localhost:3005) и войдите под логином
`admin` и паролем `admin`. В разделе **Explore** выберите источник данных Loki
и выполните запрос, например:

```logql
{job="compose"} | json
```
